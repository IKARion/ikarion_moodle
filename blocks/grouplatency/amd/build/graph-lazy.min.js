define(["jquery","block_grouplatency/d3-lazy","block_grouplatency/crossfilter-lazy","block_grouplatency/dc-lazy"],function(a,b,c,d){var e,f,g,h=0,i=5;return buildChart=function(a,h){var i=[],j=[];startDate=new Date(1e3*h[0]),startDate=startDate.setHours(0,0,0,0);var k=b.max(a,function(a){return a.date});k=new Date(1e3*k),k=k.setHours(23,59,59,999),endDate=new Date(1e3*h[1]),endDate=endDate.setHours(0,0,0,0),a.forEach(function(a,b){a.date=new Date(1e3*a.date),i.push(a.date),j.push(a.color)}),g=d.barChart("#dc-latency-chart"),e=d.dataTable("#dc-latency-table"),f=c(a);var l=f.dimension(function(a){return a.date}),m=l.group().reduceCount(function(a){return a.date});g.width(232).height(80).mouseZoomable(!1).margins({top:0,right:15,bottom:20,left:15}).dimension(l).group(m).transitionDuration(500).centerBar(!0).x(b.scaleTime().domain([startDate,endDate]).range([0,232])).xUnits(function(){return 30}).elasticY(!0).xAxis().ticks(b.timeDay.every(1)).tickFormat(function(a,c){return 0==c||7==c||14==c?b.timeFormat("%d.%m.")(a):b.timeFormat("")}),g.yAxis().ticks(0),g.colors(b.scaleOrdinal().domain(i).range(j)).colorAccessor(function(a){return a.key}),e.width(232).dimension(l).group(function(a){return""}).size(1/0).columns([function(a){return a.date_formatted},function(a){return'<a style="color:'+a.color+'" href="/mod/forum/discuss.php?d='+a.postid+'"><strong>'+a.postmsg+"</strong></a>"},function(a){return a.since}]).sortBy(function(a){return a.date}).order(b.descending),updateResult(),d.renderAll(),g.filter(d.filters.RangedFilter(startDate,k))},updateResult=function(){e.beginSlice(h),e.endSlice(h+i),f.size()>i&&(0==a(".block_grouplatency #pagination").length&&a(".block_grouplatency .grouplatency-wrapper").append('<div id="pagination"></div>'),displayPagination())},displayPagination=function(){var b=Math.ceil(f.size()/i),c=h/i+1,d='<button class="btn" id="prev"><i class="fa fa-chevron-left"></i></button>';d+='<button class="btn" disabled="disabled">'+c+" / "+b+"</button>",d+='<button class="btn" id="next"><i class="fa fa-chevron-right"></i></button>',a(".block_grouplatency #pagination").html(d),a(".block_grouplatency #pagination #prev").attr("disabled",h-i<0?"true":null),a(".block_grouplatency #pagination #next").attr("disabled",h+i>=f.size()?"true":null),a(".block_grouplatency #pagination #prev").click(function(){h-=i,updateResult(),e.redraw()}),a(".block_grouplatency #pagination #next").click(function(){h+=i,updateResult(),e.redraw()})},{init:function(a,b){buildChart(a,b)}}});