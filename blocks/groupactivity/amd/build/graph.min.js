define(["jquery","core/ajax"],function(a,b){var c;return buildGraph=function(b,d,e){var f={top:0,right:0,bottom:0,left:0},g=230,h=150;c=d3.select("#dc-activity-chart .bar-graph").append("svg").attr("width",g+f.left+f.right).attr("height",h+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")");var i=d3.layout.stack()(["item1","item2","item3"].map(function(a){return e.map(function(b){return{x:b.id,y:+b[a],color:b.color,id:b.id}})})),j=d3.scale.ordinal().domain(i[0].map(function(a){return a.x})).rangeRoundBands([10,g],.5),k=d3.scale.linear().domain([0,d]).range([h,0]),l=c.selectAll("g.cost").data(i).enter().append("g").attr("class","cost").attr("data-id",function(a,b){return b}),m=(l.selectAll("rect").data(function(a){return a}).enter().append("rect").attr("x",function(a){return j(a.x)}).attr("y",function(a){return k(a.y0+a.y)}).attr("height",function(a){return k(a.y0)-k(a.y0+a.y)}).attr("width","25px").style("stroke","#7E7E7F").attr("data-symbol-id",function(a){return a.id}).style("fill",function(b,d){var e=a(this).parent().data("id");switch(e){case 0:var f=c.append("pattern").attr("id","rectpattern"+e+b.id).attr("patternUnits","userSpaceOnUse").attr("width",5).attr("height",5).attr("patternTransform","rotate(90)"),g=f.append("rect").attr("height",5).attr("width",5).attr("fill",hexToRGB(b.color,.7));return g=f.append("rect").attr("height",5).attr("width",2).attr("fill",b.color),"url(#rectpattern"+e+b.id+")";case 1:var f=c.append("pattern").attr("id","rectpattern"+e+b.id).attr("patternUnits","userSpaceOnUse").attr("width",5).attr("height",5),g=f.append("rect").attr("height",5).attr("width",5).attr("fill",hexToRGB(b.color,.5));return g=f.append("rect").attr("height",5).attr("width",2).attr("fill",b.color),"url(#rectpattern"+e+b.id+")";case 2:return hexToRGB(b.color,.3)}}),d3.select("#dc-activity-chart .legend-graph").append("svg").attr("width",g+f.left+f.right).attr("height",70).append("g").attr("transform","translate("+f.left+","+f.top+")")),n=m.selectAll(".legend").data(b).enter().append("g").attr("class","legend").attr("transform",function(a,c){var d=b.length-1-c;return"translate(0,"+25*d+")"});n.append("rect").attr("x",0).attr("width",18).attr("height",18).style("stroke","#7E7E7E").style("fill",function(a,b){switch(b){case 2:return"none";case 1:return"url(#vertLines)";case 0:return"url(#horzLines)";default:return"none"}}),n.append("text").attr("x",25).attr("y",9).attr("dy",".35em").style("text-anchor","start").text(function(a,c){return b[c].shortname})},hexToRGB=function(a,b){var c=parseInt(a.slice(1,3),16),d=parseInt(a.slice(3,5),16),e=parseInt(a.slice(5,7),16);return b?"rgba("+c+", "+d+", "+e+", "+b+")":"rgb("+c+", "+d+", "+e+")"},{init:function(b,d,e){buildGraph(b,d,e),a(".user-symbols span").each(function(){var b=a(this).data("symbol-id"),c=a("#dc-activity-chart").offset().left,d=a('#dc-activity-chart rect[data-symbol-id="'+b+'"]'),e=parseInt(a(d).attr("x")),f=a(this).offset().top;a(this).offset({top:f,left:c+e+7})}),a("svg rect").click(function(b){var d=c.append("pattern").attr("id","rectpattern"+b.id).attr("patternUnits","userSpaceOnUse").attr("width",5).attr("height",5).attr("patternTransform","rotate(45)");d.append("rect").attr("height",20).attr("width",3).attr("fill","blue");a(this).attr("fill","url(#rectpattern"+b.id+")")})}}});